<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Task Tracker</title>
    <style>
      :root {
        color-scheme: light dark;
        --background: #f2f5f9;
        --surface: #ffffff;
        --primary: #334155;
        --accent: #0ea5e9;
        --border: #cbd5e1;
        --text: #1f2937;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
        background: var(--background);
        color: var(--text);
        line-height: 1.6;
      }

      header,
      footer {
        background: var(--primary);
        color: white;
        padding: 1.5rem 2rem;
        text-align: center;
      }

      header h1 {
        margin: 0;
        font-size: clamp(1.75rem, 2vw + 1rem, 2.5rem);
      }

      main {
        max-width: 1100px;
        margin: 2rem auto;
        padding: 0 1rem 3rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
      }

      section {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      h2 {
        margin: 0;
        font-size: 1.25rem;
        color: var(--primary);
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      label {
        font-weight: 600;
        font-size: 0.95rem;
      }

      .label {
        font-weight: 600;
        font-size: 0.95rem;
        display: block;
        margin-bottom: 0.35rem;
      }

      input[type="text"],
      input[type="number"],
      button,
      textarea {
        font: inherit;
      }

      input[type="text"],
      input[type="number"],
      textarea {
        width: 100%;
        padding: 0.65rem 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.9);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 0.65rem 1.25rem;
        background: linear-gradient(135deg, var(--accent), #1d4ed8);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(14, 165, 233, 0.3);
      }

      .pill-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 0;
        padding: 0;
        list-style: none;
      }

      .pill-list li {
        background: rgba(14, 165, 233, 0.12);
        color: var(--primary);
        border-radius: 999px;
        padding: 0.35rem 0.75rem;
        font-size: 0.85rem;
        border: 1px solid rgba(14, 165, 233, 0.35);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 10px;
        overflow: hidden;
      }

      thead {
        background: rgba(14, 165, 233, 0.15);
      }

      th,
      td {
        padding: 0.75rem 0.9rem;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      tbody tr:nth-child(even) {
        background: rgba(241, 245, 249, 0.65);
      }

      #tasks-table {
        margin: 0 auto;
        max-width: 760px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      }

      #tasks-table caption {
        padding: 1rem;
        font-weight: 600;
        font-size: 1.25rem;
        color: var(--primary);
      }

      #tasks-table tbody tr.task-completed td:first-child {
        text-decoration: line-through;
        color: #94a3b8;
      }

      #tasks-table tbody tr td:last-child {
        text-align: right;
      }

      #tasks-table tbody tr td:nth-child(3) {
        text-align: center;
      }

      #tasks-table input[type="checkbox"] {
        width: 1rem;
        height: 1rem;
      }

      #tasks-table button {
        background: #ef4444;
        box-shadow: none;
        padding: 0.5rem 0.85rem;
      }

      .helper-text {
        font-size: 0.85rem;
        color: #64748b;
        margin-top: -0.35rem;
      }

      .error-text {
        color: #dc2626;
        font-size: 0.85rem;
      }

      footer {
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        main {
          grid-template-columns: 1fr;
        }

        section {
          padding: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Team Task Tracker</h1>
      <p>Capture your tasks and watch your personal leaderboard update live.</p>
    </header>

    <main>
      <section aria-labelledby="player-heading">
        <div>
          <h2 id="player-heading">Your Name</h2>
          <p class="helper-text">
            Enter your name once to personalize your tasks and leaderboard.
          </p>
        </div>
        <form id="player-form" autocomplete="off">
          <label for="player-name">What should we call you?</label>
          <input
            id="player-name"
            name="player-name"
            type="text"
            placeholder="e.g., Alex"
            autocomplete="off"
            required
          />
          <button type="submit">Save Name</button>
        </form>
        <p id="player-summary" class="helper-text" hidden></p>
      </section>

      <section aria-labelledby="task-heading">
        <div>
          <h2 id="task-heading">Create Task</h2>
          <p class="helper-text">
            Log what you accomplish and assign point values to track progress.
          </p>
        </div>
        <form id="task-form">
          <label for="task-name">Task title</label>
          <input
            id="task-name"
            name="task-name"
            type="text"
            placeholder="Implement login flow"
            required
          />

          <label for="task-points">Point value</label>
          <input
            id="task-points"
            name="task-points"
            type="number"
            min="1"
            step="1"
            placeholder="5"
            required
          />

          <p id="name-warning" class="error-text" hidden>
            Enter your name before creating tasks.
          </p>

          <button type="submit">Add Task</button>
        </form>
      </section>

      <table
        id="tasks-table"
        aria-labelledby="tasks-heading"
        role="grid"
      >
        <caption id="tasks-heading">Current Tasks</caption>
        <thead>
          <tr>
            <th scope="col">Task</th>
            <th scope="col">Points</th>
            <th scope="col">Completed</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody id="tasks-table-body" aria-live="polite"></tbody>
      </table>

      <section aria-labelledby="leaderboard-heading">
        <h2 id="leaderboard-heading">Leaderboard</h2>
        <table>
          <thead>
            <tr>
              <th scope="col">Player</th>
              <th scope="col">Points</th>
            </tr>
          </thead>
          <tbody id="leaderboard-body"></tbody>
        </table>
      </section>
    </main>

    <footer>
      &copy; <span id="year"></span> Task Tracker. Points reset when the session ends.
    </footer>

    <script>
      const storageKey = "task-tracker-state";

      const defaultState = {
        playerName: "",
        tasks: [],
      };

      const state = loadState();

      function escapeHtml(value) {
        return String(value ?? "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      const playerForm = document.getElementById("player-form");
      const playerNameInput = document.getElementById("player-name");
      const playerSummary = document.getElementById("player-summary");
      const taskForm = document.getElementById("task-form");
      const taskNameInput = document.getElementById("task-name");
      const taskPointsInput = document.getElementById("task-points");
      const tasksTableBody = document.getElementById("tasks-table-body");
      const leaderboardBody = document.getElementById("leaderboard-body");
      const nameWarning = document.getElementById("name-warning");
      const yearSpan = document.getElementById("year");

      yearSpan.textContent = new Date().getFullYear();

      updatePlayerUI();
      renderTasks();
      renderLeaderboard();

      playerForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const name = playerNameInput.value.trim();

        if (!name) {
          return;
        }

        state.playerName = name;
        saveState();
        updatePlayerUI();
        renderTasks();
        renderLeaderboard();

        playerNameInput.value = "";
        taskNameInput.focus();
      });

      taskForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const title = taskNameInput.value.trim();
        const points = Number.parseInt(taskPointsInput.value, 10);

        if (!state.playerName) {
          nameWarning.hidden = false;
          playerForm.hidden = false;
          playerNameInput.focus();
          return;
        }

        nameWarning.hidden = true;

        state.tasks.push({
          title,
          points: Number.isFinite(points) ? points : 0,
          completed: false,
        });

        saveState();
        renderTasks();
        renderLeaderboard();

        taskForm.reset();
        taskNameInput.focus();
      });

      tasksTableBody.addEventListener("click", (event) => {
        if (event.target.matches("button[data-task-index]") &&
          event.target.dataset.taskIndex !== undefined) {
          const taskIndex = Number.parseInt(
            event.target.getAttribute("data-task-index"),
            10
          );
          if (Number.isInteger(taskIndex)) {
            state.tasks.splice(taskIndex, 1);
            saveState();
            renderTasks();
            renderLeaderboard();
          }
        }
      });

      tasksTableBody.addEventListener("change", (event) => {
        if (
          event.target.matches('input[type="checkbox"][data-task-index]') &&
          event.target.dataset.taskIndex !== undefined
        ) {
          const taskIndex = Number.parseInt(
            event.target.getAttribute("data-task-index"),
            10
          );
          if (Number.isInteger(taskIndex) && state.tasks[taskIndex]) {
            state.tasks[taskIndex].completed = event.target.checked;
            saveState();
            renderTasks();
            renderLeaderboard();
          }
        }
      });

      function renderTasks() {
        tasksTableBody.innerHTML = "";

        if (!state.tasks.length) {
          const emptyRow = document.createElement("tr");
          const emptyCell = document.createElement("td");
          emptyCell.colSpan = 4;
          emptyCell.textContent = "No tasks created yet.";
          emptyCell.style.color = "#94a3b8";
          emptyCell.style.textAlign = "center";
          emptyRow.appendChild(emptyCell);
          tasksTableBody.appendChild(emptyRow);
          return;
        }

        const fragment = document.createDocumentFragment();

        state.tasks.forEach((task, index) => {
          const row = document.createElement("tr");
          const taskPoints = Number.isFinite(task.points) ? task.points : 0;

          if (task.completed) {
            row.classList.add("task-completed");
          }

          const titleCell = document.createElement("td");
          titleCell.textContent = task.title || "";

          const pointsCell = document.createElement("td");
          pointsCell.textContent = taskPoints;

          const completedCell = document.createElement("td");
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.dataset.taskIndex = index;
          checkbox.checked = Boolean(task.completed);
          checkbox.setAttribute(
            "aria-label",
            task.completed
              ? "Mark task as incomplete"
              : "Mark task as complete"
          );
          completedCell.appendChild(checkbox);

          const actionsCell = document.createElement("td");
          const removeButton = document.createElement("button");
          removeButton.type = "button";
          removeButton.dataset.taskIndex = index;
          removeButton.textContent = "Remove";
          actionsCell.appendChild(removeButton);

          row.append(titleCell, pointsCell, completedCell, actionsCell);
          fragment.appendChild(row);
        });

        tasksTableBody.appendChild(fragment);
      }

      function renderLeaderboard() {
        leaderboardBody.innerHTML = "";

        if (!state.playerName) {
          const row = document.createElement("tr");
          row.innerHTML = '<td colspan="2">Enter your name to see the leaderboard.</td>';
          leaderboardBody.appendChild(row);
          return;
        }

        const totalPoints = state.tasks.reduce((sum, task) => {
          if (!task.completed) {
            return sum;
          }
          const taskPoints = Number.isFinite(task.points) ? task.points : 0;
          return sum + taskPoints;
        }, 0);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${escapeHtml(state.playerName)}</td>
          <td>${totalPoints}</td>
        `;
        leaderboardBody.appendChild(row);
      }

      function updatePlayerUI() {
        if (state.playerName) {
          playerForm.hidden = true;
          playerSummary.hidden = false;
          playerSummary.innerHTML = `Playing as <strong>${escapeHtml(
            state.playerName
          )}</strong>.`;
          nameWarning.hidden = true;
        } else {
          playerForm.hidden = false;
          playerSummary.hidden = true;
          playerSummary.textContent = "";
        }
      }

      function saveState() {
        sessionStorage.setItem(storageKey, JSON.stringify(state));
      }

      function loadState() {
        try {
          const raw = sessionStorage.getItem(storageKey);
          if (!raw) {
            return structuredClone(defaultState);
          }
          const parsed = JSON.parse(raw);
          const playerName =
            typeof parsed.playerName === "string"
              ? parsed.playerName
              : Array.isArray(parsed.players) && parsed.players.length
              ? String(parsed.players[0].name ?? "")
              : "";
          const tasks = Array.isArray(parsed.tasks)
            ? parsed.tasks
                .map((task) => ({
                  title: typeof task.title === "string" ? task.title : "",
                  points: Number.isFinite(task.points) ? task.points : 0,
                  completed:
                    typeof task.completed === "boolean"
                      ? task.completed
                      : Boolean(task.done ?? task.isComplete ?? false),
                }))
                .filter((task) => task.title)
            : [];
          return {
            playerName,
            tasks,
          };
        } catch (error) {
          console.error("Failed to load state from sessionStorage", error);
          return structuredClone(defaultState);
        }
      }
    </script>
  </body>
</html>
